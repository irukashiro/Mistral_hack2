<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Class Conflict: Millionaire — 大富豪×人狼</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <!-- ===== SETUP SCREEN ===== -->
  <div id="setup-screen" class="screen active">
    <div class="setup-container">
      <h1 class="title-main">CLASS CONFLICT<br><span class="title-sub">MILLIONAIRE</span></h1>
      <p class="title-tagline">大富豪 × 人狼 × AI</p>
      <div class="setup-form">
        <label for="player-name">あなたの名前</label>
        <input type="text" id="player-name" placeholder="名前を入力..." maxlength="20" value="プレイヤー" />
        <!-- Mode Selection -->
        <div class="mode-selector">
          <div class="mode-card mode-lite active" id="mode-lite-card" onclick="selectMode('lite')">
            <div class="mode-icon">⚡</div>
            <div class="mode-name">Liteモード</div>
            <div class="mode-desc">5人固定・軽量設定<br>陽動イカサマ・Hateシステム</div>
          </div>
          <div class="mode-card mode-hard" id="mode-hard-card" onclick="selectMode('hard')">
            <div class="mode-icon">🕯️</div>
            <div class="mode-name">Hardモード</div>
            <div class="mode-desc">複雑な世界設定・事件<br>記憶喪失・因縁ドラマ</div>
          </div>
        </div>
        <input type="hidden" id="game-mode" value="lite" />

        <!-- Hard mode only: NPC count -->
        <div id="npc-count-row" class="hidden">
          <label for="npc-count">NPC人数</label>
          <select id="npc-count">
            <option value="3">3人</option>
            <option value="4" selected>4人</option>
            <option value="5">5人</option>
            <option value="6">6人</option>
          </select>
        </div>
        <button id="start-btn" class="btn-primary">ゲーム開始</button>
        <p id="setup-error" class="error-msg hidden"></p>
      </div>
      <div id="loading-overlay" class="loading hidden">
        <div class="spinner"></div>
        <p>キャラクターを生成中...</p>
      </div>
    </div>
  </div>

  <!-- ===== GAME SCREEN ===== -->
  <div id="game-screen" class="screen hidden">
    <!-- Header -->
    <header class="game-header">
      <div class="header-left">
        <span class="header-day" id="header-day">Day 1</span>
        <span class="header-phase" id="header-phase">昼</span>
      </div>
      <div class="header-center">
        <span class="game-title-small">CLASS CONFLICT</span>
      </div>
      <div class="header-right">
        <span class="header-role-label">あなたの役割:</span>
        <span class="header-role" id="header-role">—</span>
        <span id="header-game-role" class="game-role-badge" style="display:none;"></span>
        <span class="header-cards" id="header-cards">手札: 0枚</span>
        <button id="auto-mode-btn" class="btn-auto-mode" title="オートモード（プレイヤー入力なしで自動進行）">⚡ AUTO</button>
        <button id="device-toggle-btn" class="btn-secondary" title="スマート端末">📱 端末</button>
        <button id="goto-result-btn" class="btn-goto-result" title="リザルトを見る">📋 リザルト</button>
        <button id="debug-toggle-btn" class="btn-debug-toggle" title="神の目モード">👁</button>
      </div>
    </header>

    <!-- Revolution Banner -->
    <div id="revolution-banner" class="revolution-banner hidden">⚡ 革命中 — 強弱逆転！ ⚡</div>

    <!-- Night Situation Banner -->
    <div id="night-situation-banner" class="night-situation hidden">
      <span id="night-situation-text"></span>
    </div>

    <!-- Ghost Mode Banner -->
    <div id="ghost-mode-banner" class="ghost-mode-banner hidden">
      👻 ゴーストモード — 観戦中。すべての真実が見えます
    </div>

    <!-- Main Area -->
    <div class="game-body">
    <main class="game-main">

      <!-- ===== DAY PHASE ===== -->
      <div id="day-phase" class="phase-panel active">
        <div class="day-layout">

          <!-- Players Panel -->
          <aside class="players-panel">
            <h3>生存者</h3>
            <div id="players-list" class="players-list"></div>
          </aside>

          <!-- Chat Area -->
          <section class="chat-section">
            <div id="chat-log" class="chat-log"></div>
            <div class="chat-input-area">
              <input type="text" id="chat-input" placeholder="発言する..." maxlength="200" />
              <button id="chat-send-btn" class="btn-secondary">送信</button>
            </div>
            <div id="chat-limit-info" class="chat-limit-info">残り <span id="chat-remaining">5</span> 回</div>
            <!-- v4.1: CO Declaration buttons (Lite mode only) -->
            <div id="co-buttons" class="co-buttons hidden">
              <span class="co-label">役職CO：</span>
              <button class="btn-co" data-co="detective">探偵CO</button>
              <button class="btn-co" data-co="heimin">平民CO</button>
              <button class="btn-co" data-co="fugo">富豪CO</button>
              <button class="btn-co" data-co="hinmin">貧民CO</button>
            </div>
            <button id="intro-btn" class="btn-intro hidden">🎭 みんな、自己紹介してください</button>
            <button id="hints-toggle-btn" class="btn-secondary hints-toggle-btn">💡 ヒント表示</button>
            <div id="hints-panel" class="hints-panel hidden">
              <div class="hints-row" id="hints-list"></div>
              <div class="templates-row" id="templates-list"></div>
              <button id="hints-refresh-btn" class="btn-refresh-hints">↺ 更新</button>
            </div>
            <div class="day-actions">
              <button id="collect-votes-btn" class="btn-secondary">NPCに投票させる</button>
              <button id="finalize-vote-btn" class="btn-danger">投票確定・処刑</button>
            </div>
            <div id="notes-panel" class="notes-panel">
              <button id="notes-toggle-btn" class="notes-toggle-btn">📝 捜査メモ <span id="notes-count">0</span>件 ▾</button>
              <div id="notes-list" class="notes-list hidden"></div>
            </div>
            <div id="amnesia-panel" class="amnesia-panel">
              <button id="amnesia-toggle-btn" class="amnesia-toggle-btn">🌀 記憶の断片 <span id="amnesia-count">0</span>件 ▾</button>
              <div id="amnesia-list" class="amnesia-list hidden"></div>
            </div>
          </section>

          <!-- v4.1: Logic Board Summary -->
          <div id="board-summary-panel" class="board-summary-panel hidden">
            <div class="board-summary-header">📊 盤面サマリー</div>
            <div id="board-summary-list" class="board-summary-list"></div>
            <div id="board-suggestions-list" class="board-suggestions-list"></div>
            <div id="board-template-btns" class="board-template-btns"></div>
          </div>

          <!-- Vote Panel -->
          <aside class="vote-panel">
            <h3>投票</h3>
            <p class="vote-hint">処刑する人物を選んでください</p>
            <div id="vote-list" class="vote-list"></div>
            <div id="vote-tally" class="vote-tally hidden"></div>
          </aside>

        </div>
      </div>

      <!-- ===== NIGHT PHASE ===== -->
      <div id="night-phase" class="phase-panel hidden">

        <!-- Cheat Initiate Panel (human hinmin can cheat) -->
        <div id="cheat-panel" class="cheat-overlay hidden">
          <div class="cheat-box">
            <h3 class="cheat-title">⚠ イカサマフェーズ</h3>
            <p class="cheat-desc">あなたは貧民です。誰かにイカサマを仕掛けますか？</p>
            <label class="cheat-label">ターゲット</label>
            <select id="cheat-target" class="cheat-select"></select>
            <label class="cheat-label">ズルの手口を入力（自由記述）</label>
            <textarea id="cheat-method" class="cheat-textarea" placeholder="例：ポケットに隠したカードとすり替える…" rows="3"></textarea>
            <div class="cheat-actions">
              <button id="cheat-submit-btn" class="btn-primary">ズルを仕掛ける</button>
              <button id="cheat-skip-btn" class="btn-secondary">今回はやめる</button>
            </div>
          </div>
        </div>

        <!-- Defend Panel (NPC targeted human) -->
        <div id="defend-panel" class="cheat-overlay hidden">
          <div class="cheat-box">
            <h3 class="cheat-title">⚠ 何かが起きる気配が…</h3>
            <p id="cheat-hint-text" class="cheat-hint"></p>
            <label class="cheat-label">警戒カテゴリを選択（1つだけ）</label>
            <select id="defense-category" class="cheat-select">
              <option value="視覚">視覚（相手の手や表情を目で追う）</option>
              <option value="聴覚">聴覚（物音・紙の擦れる音に集中）</option>
              <option value="触覚">触覚（手札を強く握って離さない）</option>
              <option value="場を監視">場（テーブル上のカードを監視）</option>
              <option value="背後を警戒">背後（周囲の動きに目を光らせる）</option>
            </select>
            <label class="cheat-label">対策を入力してください</label>
            <textarea id="defense-method" class="cheat-textarea" placeholder="例：カードをしっかり握って離さない…" rows="3"></textarea>
            <div class="cheat-actions">
              <button id="defense-submit-btn" class="btn-primary">対策を実行する</button>
            </div>
          </div>
        </div>

        <!-- Cheat Result Panel -->
        <div id="cheat-result-panel" class="cheat-overlay hidden">
          <div class="cheat-box">
            <h3 id="cheat-result-title" class="cheat-title"></h3>
            <p id="cheat-result-story" class="cheat-story"></p>
            <p id="cheat-result-reveal" class="cheat-reveal hidden"></p>
            <div class="cheat-actions">
              <button id="cheat-result-ok" class="btn-primary">続ける</button>
            </div>
          </div>
        </div>

        <!-- ===== LITE MODE CHEAT PANELS ===== -->

        <!-- v4: Detective panel (Lite mode, detective player only) -->
        <div id="v4-detective-panel" class="cheat-overlay hidden">
          <div class="cheat-box lite-cheat-box">
            <h3 class="cheat-title">🔍 探偵の調査</h3>
            <p class="cheat-desc">夜の開始時に1人を密かに調査できます。（1回のみ）</p>
            <div class="cheat-label">調査対象</div>
            <select id="detective-target-select" class="cheat-select"></select>
            <div class="cheat-label" style="margin-top:8px;">調査内容</div>
            <div class="detective-radio-group">
              <label><input type="radio" name="detective-info" value="class" checked> 階級を調べる</label>
              <label><input type="radio" name="detective-info" value="strongest_card"> 最強カードを調べる</label>
            </div>
            <div class="cheat-actions">
              <button id="detective-investigate-btn" class="btn-primary">調査する</button>
              <button id="detective-skip-btn" class="btn-secondary">スキップ</button>
            </div>
            <div id="detective-result-area" class="detective-result-area" style="display:none;"></div>
          </div>
        </div>

        <!-- Lite: Cheater inputs Decoy + Real -->
        <div id="lite-cheat-decoy-panel" class="cheat-overlay hidden">
          <div class="cheat-box lite-cheat-box">
            <h3 class="cheat-title">🎭 陽動イカサマ</h3>
            <p class="cheat-desc">あなたは貧民です。陽動と本命を別々に入力してください。相手には陽動のみが表示されます。</p>
            <label class="cheat-label">ターゲット</label>
            <select id="lite-cheat-target" class="cheat-select"></select>
            <div class="lite-cheat-inputs">
              <div class="lite-cheat-field">
                <label class="cheat-label">【陽動】相手の注意を引くアクション</label>
                <textarea id="lite-decoy-text" class="cheat-textarea" placeholder="例：「うわっ、虫！」と叫びながら天井を指さす" rows="2" maxlength="100"></textarea>
              </div>
              <div class="lite-cheat-field">
                <label class="cheat-label">【本命】実際にカードを奪うアクション</label>
                <textarea id="lite-real-text" class="cheat-textarea" placeholder="例：相手が上を向いた隙に右端のカードを素早く抜く" rows="2" maxlength="100"></textarea>
              </div>
            </div>
            <div class="cheat-actions">
              <button id="lite-cheat-submit-btn" class="btn-primary">陽動を仕掛ける！</button>
              <button id="lite-cheat-skip-btn" class="btn-secondary">今回はやめる</button>
            </div>
          </div>
        </div>

        <!-- Lite: Defender reacts to Decoy (15-char, 5-sec timer) -->
        <div id="lite-cheat-react-panel" class="cheat-overlay hidden">
          <div class="cheat-box lite-react-box">
            <h3 class="cheat-title lite-react-title">⚡ 突然の出来事！</h3>
            <div id="lite-decoy-display" class="lite-decoy-display"></div>
            <div class="lite-react-timer-row">
              <span class="lite-react-timer-label">残り</span>
              <span id="lite-react-timer" class="lite-react-timer">5</span>
              <span class="lite-react-timer-label">秒</span>
            </div>
            <p class="cheat-desc lite-react-hint">どうする？（15文字以内で素早く入力！）</p>
            <input id="lite-react-input" class="lite-react-input" placeholder="例：上を見る、手元を守る…" maxlength="15" />
            <div class="cheat-actions">
              <button id="lite-react-submit-btn" class="btn-primary">リアクション！</button>
            </div>
          </div>
        </div>

        <!-- Lite: Cheat Result -->
        <div id="lite-cheat-result-panel" class="cheat-overlay hidden">
          <div class="cheat-box">
            <h3 id="lite-cheat-result-title" class="cheat-title"></h3>
            <p id="lite-cheat-result-story" class="cheat-story"></p>
            <p id="lite-cheat-result-reveal" class="cheat-reveal hidden"></p>
            <div class="cheat-actions">
              <button id="lite-cheat-result-ok" class="btn-primary">続ける</button>
            </div>
          </div>
        </div>

        <div class="night-layout">

          <!-- Left: Other players -->
          <aside class="night-players-panel">
            <h3>他プレイヤー</h3>
            <div id="night-players-list" class="night-players-list"></div>
          </aside>

          <!-- Center: Table & Actions -->
          <section class="night-center">
            <div class="table-area">
              <div class="table-label-row">
                <span class="table-label">場のカード</span>
                <span class="clear-counter">場流れ: <span id="clear-count">0</span>/3</span>
              </div>
              <div id="table-cards" class="table-cards">
                <span class="empty-table">（場は空き）</span>
              </div>
            </div>
            <div class="turn-indicator">
              <span id="turn-indicator-text">ターン待機中...</span>
            </div>
            <div class="hand-area">
              <div class="hand-label">あなたの手札 <span id="hand-count-label"></span></div>
              <div id="player-hand" class="player-hand"></div>
            </div>
            <div class="night-actions">
              <button id="play-cards-btn" class="btn-primary" disabled>カードを出す</button>
              <button id="pass-btn" class="btn-secondary">パス</button>
            </div>
            <div id="night-log" class="night-log"></div>

            <!-- Night Phase Chat (player can speak; NPCs react) -->
            <div id="night-chat-area" class="night-chat-area">
              <div class="night-chat-templates" id="night-chat-templates"></div>
              <div class="night-chat-input-row">
                <input id="night-chat-input" placeholder="ひとこと..." maxlength="60" />
                <button id="night-chat-send-btn" class="btn-secondary">送信</button>
              </div>
            </div>
          </section>

          <!-- Right: Hanged player info -->
          <aside class="hanged-panel" id="hanged-panel">
            <h3>吊られた者</h3>
            <div id="hanged-info" class="hanged-info">
              <p class="muted">まだ誰も吊られていません</p>
            </div>
          </aside>

        </div>
      </div>

    </main>

    <!-- Debug Side Panel (god eye mode) -->
    <aside id="debug-side-panel" class="debug-side-panel hidden">
      <div class="debug-side-header">
        <span class="debug-side-title">🔍 神の目モード</span>
      </div>
      <div class="debug-section">
        <div class="debug-section-label">プレイヤー真相</div>
        <div id="debug-players-info" class="debug-players-info"></div>
      </div>
      <div class="debug-section">
        <div class="debug-section-label">関係性マトリクス</div>
        <div id="debug-rel-matrix-inline" class="debug-rel-matrix-inline"></div>
      </div>
      <div class="debug-section">
        <div class="debug-section-label">AIログ</div>
        <div id="debug-ai-log-inline" class="debug-ai-log-inline"></div>
      </div>
    </aside>

    <!-- Smart Device (Player status book) -->
    <aside id="smart-device-panel" class="smart-device-panel hidden">
      <div class="smart-device-header">
        <span class="smart-device-title">📱 スマート端末</span>
        <button id="smart-device-close" class="smart-device-close">✕</button>
      </div>
      <div class="smart-device-tabs">
        <button data-tab="profile" class="sd-tab active">PROFILE</button>
        <button data-tab="main" class="sd-tab">MAIN MISSION</button>
        <button data-tab="secret" class="sd-tab">SECRET MISSION</button>
      </div>
      <div class="smart-device-body">
        <div id="sd-profile" class="sd-panel active">
          <div id="sd-profile-content">読み込み中...</div>
        </div>
        <div id="sd-main" class="sd-panel">
          <div id="sd-main-content">読み込み中...</div>
        </div>
        <div id="sd-secret" class="sd-panel">
          <div id="sd-secret-content">読み込み中...</div>
        </div>
        <div class="sd-hint-row">
          <h4>ヒント</h4>
          <div id="sd-hints" class="sd-hints">—</div>
        </div>
      </div>
    </aside>

    </div><!-- /.game-body -->

    <!-- Relationship Matrix Panel (god eye mode only) -->
    <div id="relationship-matrix-panel" class="relationship-matrix-panel hidden">
      <div class="rel-matrix-header">
        <span class="rel-matrix-title">🔗 関係性マトリクス</span>
        <button id="rel-matrix-close" class="rel-matrix-close">✕</button>
      </div>
      <div id="rel-matrix-body" class="rel-matrix-body"></div>
    </div>

    <!-- Debug Log Panel (god eye mode only) -->
    <div id="debug-log-panel" class="debug-log-panel hidden">
      <div class="debug-log-header">
        <span class="debug-log-title">🔍 AI判断ログ</span>
        <button id="debug-log-close" class="debug-log-close">✕</button>
      </div>
      <div id="debug-log-entries" class="debug-log-entries"></div>
    </div>
  </div>

  <!-- ===== GAME OVER SCREEN (Rich Result) ===== -->
  <div id="gameover-screen" class="screen hidden">
    <div class="result-container">
      <h2 id="gameover-title">ゲーム終了</h2>

      <!-- World Setting & True Story -->
      <section class="result-section" id="result-world-section">
        <h3 class="result-section-title">📖 世界設定 · 真相</h3>
        <div id="result-world-header" class="result-world-header"></div>
        <div id="result-full-incident" class="result-full-incident"></div>
      </section>

      <!-- Player's True Backstory Reveal -->
      <section class="result-section" id="result-amnesia-section">
        <h3 class="result-section-title">🌀 あなたの真の素性</h3>
        <div id="result-player-secret" class="result-player-secret"></div>
      </section>

      <!-- Victory Reason -->
      <section class="result-section" id="result-victory-reason-section">
        <h3 class="result-section-title">🏆 勝利理由</h3>
        <div id="result-victory-reason" class="result-victory-reason"></div>
      </section>

      <!-- Characters -->
      <section class="result-section">
        <h3 class="result-section-title">キャラクター一覧</h3>
        <div id="result-characters" class="result-characters"></div>
      </section>

      <!-- Relationships -->
      <section class="result-section">
        <h3 class="result-section-title">関係図</h3>
        <div id="result-relationships" class="result-relationships"></div>
      </section>

      <!-- Cheat Log -->
      <section class="result-section">
        <h3 class="result-section-title">イカサマ記録</h3>
        <div id="result-cheat-log" class="result-cheat-log"></div>
      </section>

      <button id="restart-btn" class="btn-primary">もう一度プレイ</button>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
